<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Grid Block Designer</title>
  <style>
    body {
      font-family: sans-serif;
      padding: 20px;
      text-align: center;
    }
    #controls {
      margin-bottom: 20px;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 10px;
    }
    #undo-redo {
      display: flex;
      gap: 10px;
    }
    #grid-wrapper {
      display: flex;
      justify-content: center;
    }
    #grid {
      display: grid;
      gap: 1px;
      border: 2px solid #444;
      background-color: #444;
    }
    .cell {
      background-color: #eee;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      font-size: 16px;
      user-select: none;
    }
  </style>
</head>
<body>

  <h2>Grid Block Designer</h2>
  <div id="controls">
    <label>Rows: <input type="number" id="rows" value="8" min="1"></label>
    <label>Cols: <input type="number" id="cols" value="8" min="1"></label>
    <label>Color:
      <input type="color" id="colorPicker" value="#3498db">
      <input type="checkbox" id="colorNone"> None
    </label>
    <label>Character:
      <select id="charPicker">
        <option value="">None</option>
        <option value="+">+</option>
        <option value="L">L</option>
        <option value="X">X</option>
        <option value="o">o</option>
        <option value="▦">▦</option>
        <option value="♀">♀</option>
      </select>
    </label>
    <label>Cell Size: <input type="range" id="cellSize" min="10" max="50" value="20" oninput="updateGridSizeLabel()"> <span id="cellSizeLabel">20px</span></label>
    <button onclick="createGrid()">Create Grid</button>
    <button onclick="setEraserMode()">Eraser</button>
    <button onclick="setCharEraserMode()">Erase Character</button>
    <div id="undo-redo">
      <button onclick="undo()">Undo</button>
      <button onclick="redo()">Redo</button>
    </div>
    <button onclick="exportAsImage()">Export as Image</button>
  </div>

  <div id="grid-wrapper">
    <div id="grid"></div>
  </div>

  <script>
    let eraserMode = false;
    let charEraserMode = false;
    let undoStack = [];
    let redoStack = [];

    function createGrid() {
      const grid = document.getElementById("grid");
      const rows = parseInt(document.getElementById("rows").value);
      const cols = parseInt(document.getElementById("cols").value);
      const cellSize = parseInt(document.getElementById("cellSize").value);

      // Clear grid
      grid.innerHTML = "";
      grid.style.gridTemplateColumns = `repeat(${cols}, ${cellSize}px)`;

      for (let i = 0; i < rows * cols; i++) {
        const cell = document.createElement("div");
        cell.className = "cell";
        cell.style.width = `${cellSize}px`;
        cell.style.height = `${cellSize}px`;

        cell.addEventListener("click", () => {
          saveState();

          const useNoneColor = document.getElementById("colorNone").checked;
          const colorValue = document.getElementById("colorPicker").value;
          const selectedChar = document.getElementById("charPicker").value;

          if (eraserMode) {
            cell.style.backgroundColor = "#eee";
          } else if (!useNoneColor) {
            cell.style.backgroundColor = colorValue;
          }

          if (charEraserMode) {
            cell.textContent = "";
          } else {
            cell.textContent = selectedChar;
          }
        });

        grid.appendChild(cell);
      }

      saveState(true); // Reset undo stack with initial state
    }

    function setEraserMode() {
      eraserMode = !eraserMode;
      const btn = document.querySelector("button[onclick='setEraserMode()']");
      btn.textContent = eraserMode ? "Eraser (On)" : "Eraser";
    }

    function setCharEraserMode() {
      charEraserMode = !charEraserMode;
      const btn = document.querySelector("button[onclick='setCharEraserMode()']");
      btn.textContent = charEraserMode ? "Erase Character (On)" : "Erase Character";
    }

    function updateGridSizeLabel() {
      const size = document.getElementById("cellSize").value;
      document.getElementById("cellSizeLabel").textContent = `${size}px`;
    }

    function saveState(reset = false) {
      const grid = document.getElementById("grid");
      const state = Array.from(grid.children).map(cell => ({
        bg: cell.style.backgroundColor,
        text: cell.textContent
      }));
      if (reset) {
        undoStack = [state];
        redoStack = [];
      } else {
        undoStack.push(state);
        redoStack = [];
      }
    }

    function restoreState(state) {
      const grid = document.getElementById("grid");
      const cells = Array.from(grid.children);
      state.forEach((data, i) => {
        cells[i].style.backgroundColor = data.bg;
        cells[i].textContent = data.text;
      });
    }

    function undo() {
      if (undoStack.length > 1) {
        const current = undoStack.pop();
        redoStack.push(current);
        restoreState(undoStack[undoStack.length - 1]);
      }
    }

    function redo() {
      if (redoStack.length > 0) {
        const next = redoStack.pop();
        undoStack.push(next);
        restoreState(next);
      }
    }

    function exportAsImage() {
      const grid = document.getElementById("grid");
      const cells = Array.from(grid.children);
      const cols = parseInt(document.getElementById("cols").value);
      const rows = parseInt(document.getElementById("rows").value);
      const cellSize = parseInt(document.getElementById("cellSize").value);
      const canvas = document.createElement("canvas");
      canvas.width = cols * cellSize;
      canvas.height = rows * cellSize;
      const ctx = canvas.getContext("2d");

      ctx.font = `${Math.floor(cellSize * 0.6)}px sans-serif`;
      ctx.textAlign = "center";
      ctx.textBaseline = "middle";

      cells.forEach((cell, index) => {
        const color = window.getComputedStyle(cell).backgroundColor;
        const text = cell.textContent;
        const x = (index % cols) * cellSize;
        const y = Math.floor(index / cols) * cellSize;
        ctx.fillStyle = color;
        ctx.fillRect(x, y, cellSize, cellSize);
        if (text) {
          ctx.fillStyle = "#000";
          ctx.fillText(text, x + cellSize / 2, y + cellSize / 2);
        }
      });

      const link = document.createElement("a");
      link.download = "grid-design.png";
      link.href = canvas.toDataURL();
      link.click();
    }

    createGrid();
  </script>

</body>
</html>
