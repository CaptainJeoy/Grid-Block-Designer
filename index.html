<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Grid Designer</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #fff;
      color: #000;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 10px;
      transition: background 0.3s, color 0.3s;
    }

    body.dark {
      background: #222;
      color: #eee;
    }

    .toolbar {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-bottom: 10px;
      justify-content: center;
    }

    .toolbar label {
      font-size: 14px;
    }

    .grid {
      display: grid;
      border: 2px solid #555; /* full symmetrical border */
      margin-top: 10px;
    }

    .cell {
      border: 1px solid #333;
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
      cursor: pointer;
      overflow: hidden;
      color: #000;
      font-size: 25px;       /* bigger char */
      font-weight: bold;     /* bold char */
    }

    body.dark .cell {
      color: #fff;
    }

    .coord-label {
      position: absolute;
      bottom: 2px;
      right: 2px;
      font-size: 8px;
      opacity: 0.25; /* more faded out */
      pointer-events: none;
      user-select: none;
    }

    button, input[type="color"], input[type="number"], input[type="range"] {
      padding: 5px;
      background: #eee;
      color: #000;
      border: 1px solid #666;
      border-radius: 4px;
    }

    body.dark button,
    body.dark input[type="color"],
    body.dark input[type="number"],
    body.dark input[type="range"] {
      background: #444;
      color: #fff;
    }

    button.active {
      background: #008cff;
      color: #fff;
    }

    .tooltip {
      position: absolute;
      background: #333;
      color: #fff;
      padding: 3px 6px;
      border-radius: 3px;
      font-size: 12px;
      white-space: nowrap;
      z-index: 10;
      pointer-events: none;
      opacity: 0;
      transition: opacity 0.15s;
    }
  </style>
</head>
<body>
  <h1>Grid Designer</h1>

  <div class="toolbar">
    <label>Rows: <input type="number" id="rows" value="5" min="1"/></label>
    <label>Cols: <input type="number" id="cols" value="5" min="1"/></label>
    <label>Cell Size: <input type="range" id="cellSize" min="10" max="100" value="40"/></label>
    <button id="newGrid">New Grid</button>
    <button id="updateGrid">Update Grid</button>
  </div>

  <div class="toolbar">
    <button id="paintTool">Paint (P)</button>
    <button id="eraseTool">Erase (E)</button>
    <button id="charTool">Char (C)</button>
    <input type="color" id="colorPicker" value="#ff0000"/>
    <input type="text" id="charInput" maxlength="1" placeholder="A"/>
  </div>

  <div class="toolbar">
    <button id="undo">Undo (Ctrl+Z)</button>
    <button id="redo">Redo (Ctrl+Y)</button>
    <button id="save">Save</button>
    <button id="load">Load</button>
    <button id="darkMode">Dark Mode</button>
  </div>

  <div id="grid" class="grid"></div>
  <div id="tooltip" class="tooltip"></div>

  <script>
    const gridEl = document.getElementById("grid");
    const rowsInput = document.getElementById("rows");
    const colsInput = document.getElementById("cols");
    const cellSizeInput = document.getElementById("cellSize");
    const newGridBtn = document.getElementById("newGrid");
    const updateGridBtn = document.getElementById("updateGrid");

    const paintBtn = document.getElementById("paintTool");
    const eraseBtn = document.getElementById("eraseTool");
    const charBtn = document.getElementById("charTool");
    const colorPicker = document.getElementById("colorPicker");
    const charInput = document.getElementById("charInput");

    const undoBtn = document.getElementById("undo");
    const redoBtn = document.getElementById("redo");
    const saveBtn = document.getElementById("save");
    const loadBtn = document.getElementById("load");
    const darkBtn = document.getElementById("darkMode");

    const tooltip = document.getElementById("tooltip");

    let rows = parseInt(rowsInput.value);
    let cols = parseInt(colsInput.value);
    let cellSize = parseInt(cellSizeInput.value);

    // NEW: remember previous grid dimensions so we can resize correctly
    let prevRows = rows;
    let prevCols = cols;

    let tool = "paint";
    let grid = [];
    let undoStack = [];
    let redoStack = [];

    function saveState() {
      undoStack.push(JSON.stringify(grid));
      redoStack = [];
    }

    function restoreState(state) {
      grid = JSON.parse(state);
      renderGrid();
    }

    function createGrid(reset = true) {
      if (reset) {
        grid = Array(rows * cols).fill().map(() => ({}));
        saveState();
      } else {
        // resize grid while preserving old data
        const newGrid = Array(rows * cols).fill().map(() => ({}));
        const copyRows = Math.min(rows, prevRows);
        const copyCols = Math.min(cols, prevCols);
        for (let r = 0; r < copyRows; r++) {
          for (let c = 0; c < copyCols; c++) {
            const oldIndex = r * prevCols + c;
            const newIndex = r * cols + c;
            if (grid[oldIndex]) {
              // copy the object so we don't accidentally link references
              newGrid[newIndex] = Object.assign({}, grid[oldIndex]);
            }
          }
        }
        grid = newGrid;
        saveState();
      }
      // update prev dims so future updates map correctly
      prevRows = rows;
      prevCols = cols;
      renderGrid();
    }

    function renderGrid() {
      gridEl.innerHTML = "";
      gridEl.style.gridTemplateRows = `repeat(${rows}, ${cellSize}px)`;
      gridEl.style.gridTemplateColumns = `repeat(${cols}, ${cellSize}px)`;

      for (let r = 0; r < rows; r++) {
        for (let c = 0; c < cols; c++) {
          const index = r * cols + c;
          const cellData = grid[index] || {};
          const cell = document.createElement("div");
          cell.className = "cell";
          cell.style.width = `${cellSize}px`;
          cell.style.height = `${cellSize}px`;
          cell.style.backgroundColor = cellData.color || "";

          if (cellData.char) {
            cell.textContent = cellData.char;
          }

          const coordLabel = document.createElement("div");
          coordLabel.className = "coord-label";
          coordLabel.textContent = `(${rows - r - 1}, ${c})`; // bottom-left start
          cell.appendChild(coordLabel);

          cell.dataset.coord = `(${rows - r - 1}, ${c})`;

          cell.addEventListener("click", () => handleCellClick(cell, index));
          cell.addEventListener("mouseenter", (e) => {
            tooltip.textContent = cell.dataset.coord;
            tooltip.style.left = e.pageX + 10 + "px";
            tooltip.style.top = e.pageY + 10 + "px";
            tooltip.style.opacity = 1;
          });
          cell.addEventListener("mouseleave", () => {
            tooltip.style.opacity = 0;
          });

          gridEl.appendChild(cell);
        }
      }
    }

    function handleCellClick(cell, index) {
      saveState();
      if (tool === "paint") {
        // ensure grid[index] exists
        if (!grid[index]) grid[index] = {};
        grid[index].color = colorPicker.value;
        grid[index].char = "";
      } else if (tool === "erase") {
        grid[index] = {};
      } else if (tool === "char") {
        if (!grid[index]) grid[index] = {};
        grid[index].char = charInput.value;
        grid[index].color = "";
      }
      renderGrid();
    }

    function setTool(newTool) {
      tool = newTool;
      paintBtn.classList.toggle("active", tool === "paint");
      eraseBtn.classList.toggle("active", tool === "erase");
      charBtn.classList.toggle("active", tool === "char");
    }

    paintBtn.onclick = () => setTool("paint");
    eraseBtn.onclick = () => setTool("erase");
    charBtn.onclick = () => setTool("char");

    newGridBtn.onclick = () => {
      rows = parseInt(rowsInput.value);
      cols = parseInt(colsInput.value);
      cellSize = parseInt(cellSizeInput.value);
      createGrid(true);
    };

    updateGridBtn.onclick = () => {
      // capture previous dims before overwriting globals
      prevRows = rows;
      prevCols = cols;
      rows = parseInt(rowsInput.value);
      cols = parseInt(colsInput.value);
      cellSize = parseInt(cellSizeInput.value);
      createGrid(false);
    };

    undoBtn.onclick = () => {
      if (undoStack.length > 0) {
        redoStack.push(JSON.stringify(grid));
        restoreState(undoStack.pop());
      }
    };

    redoBtn.onclick = () => {
      if (redoStack.length > 0) {
        undoStack.push(JSON.stringify(grid));
        restoreState(redoStack.pop());
      }
    };

    saveBtn.onclick = () => {
      localStorage.setItem("gridData", JSON.stringify(grid));
      alert("Grid saved!");
    };

    loadBtn.onclick = () => {
      const data = localStorage.getItem("gridData");
      if (data) {
        restoreState(data);
      }
    };

    darkBtn.onclick = () => {
      document.body.classList.toggle("dark");
    };

    document.addEventListener("keydown", (e) => {
      if (e.ctrlKey && e.key === "z") undoBtn.click();
      if (e.ctrlKey && e.key === "y") redoBtn.click();
      if (e.key.toLowerCase() === "p") setTool("paint");
      if (e.key.toLowerCase() === "e") setTool("erase");
      if (e.key.toLowerCase() === "c") setTool("char");
    });

    createGrid(true);
    setTool("paint");
  </script>
</body>
</html>
